{"version":3,"file":"diamond.min.js","sources":["../.gobble-build/07-rollup/1/diamond.js"],"sourcesContent":["(function () {\n\t'use strict';\n\n\tvar Context = function Context ( data ) {\n\t\tthis.data = data;\n\t};\n\n\tContext.prototype.get = function get ( ref ) {\n\t\treturn ref === '.' ? this.data : this.data[ ref ];\n\t};\n\n\tvar Binding = function Binding ( binding ) {\n\t\tthis.binding = binding;\n\t};\n\n\tfunction $( children ) {\n\t\treturn $.section( children );\n\t}\n\n\t$.section = function( children ) {\n\t\tvar fragment = document.createDocumentFragment();\n\t\tappendChildren( fragment, children );\n\t\treturn fragment;\n\t};\n\t\t\n\t$.text = function( text ) {\n\t\treturn document.createTextNode( text );\n\t};\n\t\t\n\t$.comment = function( comment ) {\n\t\treturn document.createComment( comment );\n\t};\n\t\t\n\t$.el = function( name, children ) {\n\t\tvar element = document.createElement( name );\n\t\tappendChildren( element, children );\n\t\treturn element;\n\t};\n\n\tfunction appendChildren( parent, children ) {\n\t\tvar child;\n\t\t\n\t\tfor ( var i = 0, l = children.length; i < l; i++ ) {\n\t\t\tchild = children[ i ];\n\t\t\tif ( child instanceof Binding ){\n\t\t\t\tchild = getNodeFromBinding( child );\n\t\t\t};\n\t\t\tparent.appendChild( child );\n\t\t}\n\t}\n\n\tfunction getNodeFromBinding( binding ) {\n\t\tvar node = binding.node();\n\t\tnode._binding = binding;\n\t\treturn node;\n\t}\n\n\tfunction getBindings( clone, bindingTree ) {\n\t\t\t\t\n\t\tvar queue = [];\n\t\t\n\t\tfunction queueBindings( node, bindingTree ) {\n\t\t\tif ( !bindingTree ) return;\n\t\t\t\n\t\t\tvar childNodes = node.childNodes;\n\t\t\t\n\t\t\tvar map, index, childNode, bindings;\n\t\t\t\n\t\t\tfor( var i = 0, l = bindingTree.length; i < l; i++ ){\n\t\t\t\tmap = bindingTree[i];\n\t\t\t\tbindings = map.bindings;\n\t\t\t\tindex = map.index || 0;\n\t\t\t\tchildNode = childNodes[ index ];\n\t\t\t\t\n\t\t\t\tif ( bindings ) {\n\t\t\t\t\tfor( var j = 0, bl = bindings.length; j < bl; j++ ) {\n\t\t\t\t\t\tqueue.push({ \n\t\t\t\t\t\t\tbinding: bindings[j],\n\t\t\t\t\t\t\tnode: childNode,\n\t\t\t\t\t\t\tparent: node,\n\t\t\t\t\t\t\tindex: index,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tqueueBindings( childNode, map.children );\t\n\t\t\t}\n\t\t}\t\n\t\t\n\t\tqueueBindings( clone, bindingTree );\n\t\t\n\t\treturn queue;\n\t}\n\n\tfunction getBindingTree( childNodes ) {\n\t\t\n\t\tif ( !childNodes ) return;\n\t\tvar l = childNodes.length;\n\t\tif ( !l ) return;\n\t\t\n\t\tvar results, childNode, result, children, binding\n\t\t\n\t\tfor( var i = 0; i < l; i++ ) {\n\t\t\n\t\t\tchildNode = childNodes[i];\n\t\t\tresult = null;\n\t\t\t \n\t\t\tchildren = getBindingTree( Array.isArray( childNode ) ? childNode : childNode.childNodes );\n\t\t\t\n\t\t\tif ( children ) {\n\t\t\t\tresult = { children: children };\n\t\t\t}\n\t\t\t\n\t\t\tbinding = childNode._binding;\n\t\t\t\n\t\t\tif( binding ) {\n\t\t\t\tresult = result || {};\n\t\t\t\tresult.bindings = [ binding ];\n\t\t\t\tdelete childNode._binding;\n\t\t\t}\n\t\t\t\n\t\t\tif ( result ) {\n\t\t\t\tif (i) result.index = i;\n\t\t\t\tresults = results || [];\n\t\t\t\tresults.push( result );\n\t\t\t}\t\n\t\t}\n\t\t\n\t\treturn results && results.length ? results : null;\t\n\t}\n\n\tvar DOMTemplate = function DOMTemplate ( fragment, bindingTree ) {\n\t\tif ( bindingTree === void 0 ) bindingTree = getBindingTree( fragment.childNodes );\n\n\t\t\tthis.fragment = fragment;\n\t\tthis.bindingTree = bindingTree;\n\t\t\t\n\t\t// console.log( JSON.stringify(bindingTree, true, 2) );\n\t};\n\t\t\n\tDOMTemplate.prototype.node = function node () {\n\t\treturn document.createDocumentFragment();\n\t};\n\t\t\n\tDOMTemplate.prototype.render = function render() {\n\t\tvar node = this.fragment.cloneNode( true );\n\t\t// const queue = [];\n\t\t// queueBindings( queue, node, this.bindingTree );\n\t\tvar queue = getBindings( node, this.bindingTree )\n\t\treturn { node: node, queue: queue };\n\t};\n\n\tfunction bind( queue, context ) {\n\t\tvar each;\n\t\tfor ( var i = 0, l = queue.length; i < l; i++ ) {\n\t\t\teach = queue[i];\n\t\t\teach.binding.bind( context, each );\n\t\t}\n\t}\n\n\tvar ForBlock = function ForBlock () {};\n\n\tForBlock.prototype.bind = function bind( context, binding, add ) {\n\t\tvar value = context.get( binding.ref );\n\t\tif ( Array.isArray( value ) ) {\n\t\t\tfor ( var i = 0, l = value.length; i < l; i++ ) {\n\t\t\t\tadd( new Context( value[i] ) );\n\t\t\t}\n\t\t}\n\t};\n\n\tvar IfBlock = function IfBlock () {};\n\n\tIfBlock.prototype.bind = function bind( context, binding, add ) {\n\t\tvar value = context.get( binding.ref );\n\t\tif ( value ) add( context );\n\t};\n\n\tvar WithBlock = function WithBlock () {};\n\n\tWithBlock.prototype.bind = function bind( context, binding, add ) {\n\t\tvar value = context.get( binding.ref );\n\t\tif ( value != null ) add( new Context( value ) );\n\t};\n\n\tvar blocks = {\n\t\tfor: ForBlock,\n\t\tif: IfBlock,\n\t\twith: WithBlock\n\t};\n\n\tvar Section = (function (Binding) {\n\t\tfunction Section ( binding, template ) {\n\t\t\tBinding.call( this, binding );\n\t\t\t\n\t\t\tthis.template = new DOMTemplate( \n\t\t\t\ttemplate.fragment, \n\t\t\t\ttemplate.bindingTree \n\t\t\t);\n\t\t\t\n\t\t\tvar Block = blocks[ binding.type ];\n\t\t\t\n\t\t\tif ( !Block ) throw new Error( (\"Unrecognized section type \" + (binding.type)) );\n\n\t\t\tthis.block = new Block();\n\t\t}\n\n\t\tSection.prototype = Object.create( Binding && Binding.prototype );\n\t\tSection.prototype.constructor = Section;\n\t\t\n\t\tSection.prototype.node = function node () {\n\t\t\treturn $.comment( this.binding.type );\n\t\t};\n\t\t\n\t\tSection.prototype.bind = function bind$1 ( context, target ) {\n\t\t\tvar anchor = target.node;\n\t\t\tvar template = this.template;\n\t\t\t\n\t\t\tfunction add( addContext ) {\n\t\t\t\tvar ref = template.render(), queue = ref.queue, node = ref.node;\n\t\t\t\tbind( queue, addContext );\n\t\t\t\tanchor.parentNode.insertBefore( node, anchor );\n\t\t\t}\n\t\t\t\n\t\t\tthis.block.bind( context, this.binding, add );\n\t\t\t\n\t\t};\n\n\t\treturn Section;\n\t}(Binding));\n\n\tvar DOMText = (function (Binding) {\n\t\tfunction DOMText () {\n\t\t\tBinding.apply(this, arguments);\n\t\t}\n\n\t\tDOMText.prototype = Object.create( Binding && Binding.prototype );\n\t\tDOMText.prototype.constructor = DOMText;\n\n\t\tDOMText.prototype.node = function node () {\n\t\t\treturn $.text( '' );\n\t\t};\n\t\t\n\t\tDOMText.prototype.bind = function bind ( context, target ) {\n\t\t\ttarget.node.textContent = context.get( this.binding.ref );\n\t\t};\n\n\t\treturn DOMText;\n\t}(Binding));\n\n\tfunction Đ( binding, children ) {\n\t\treturn Đ.section( binding, children );\n\t}\n\n\tĐ.text = function( binding ) {\n\t\treturn new DOMText( binding );\n\t};\n\n\tĐ.section = function( binding, template ) {\n\t\treturn new Section( binding, template );\n\t};\n\n\tvar dom = { \n\t\ttype: 'dom',\n\t\t$tatic: $, \n\t\tbound: Đ,\n\t\tgetTemplate: function getTemplate( fragment, bindingTree ) { \n\t\t\treturn new DOMTemplate( fragment, bindingTree ); \n\t\t}  \n\t};\n\n\tvar Diamond = function Diamond( ref ) {\n\t\tvar template = ref.template;\n\t\t\tvar data = ref.data;\n\t\t\tvar el = ref.el;\n\n\t\t\tvar fragment = template.fragment, bindingTree = template.bindingTree;\n\t\tvar rendered = dom.getTemplate( fragment, bindingTree );\n\t\tvar ref$1 = rendered.render(), queue = ref$1.queue, node = ref$1.node;\n\t\tvar context = new Context( data );\n\t\tbind( queue, context );\n\t\tel.appendChild( node );\n\t};\n\n\tDiamond.dom = dom;\n\n\tself.Diamond = Diamond;\n\n}());"],"names":["$","children","section","appendChildren","parent","child","i","l","length","Binding","getNodeFromBinding","appendChild","binding","node","_binding","getBindings","clone","bindingTree","queueBindings","map","index","childNode","bindings","childNodes","j","bl","queue","push","getBindingTree","results","result","Array","isArray","bind","context","each","Đ","Context","data","this","prototype","get","ref","fragment","document","createDocumentFragment","text","createTextNode","comment","createComment","el","name","element","createElement","DOMTemplate","render","cloneNode","ForBlock","add","value","IfBlock","WithBlock","blocks","for","if","with","Section","template","call","Block","type","Error","block","Object","create","constructor","target","addContext","anchor","parentNode","insertBefore","DOMText","apply","arguments","textContent","dom","$tatic","bound","getTemplate","Diamond","rendered","ref$1","self"],"mappings":"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"}